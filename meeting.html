    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>Convox Elite - Live Meeting</title>
        <script src="https://kit.fontawesome.com/a7b1b11b13.js" crossorigin="anonymous"></script>
        
        <script src="https://convox-themetup.onrender.com/socket.io/socket.io.js"></script>

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
        <style>
    body {
  font-family: Montserrat, sans-serif;
  background: #121212;
  color: #f0f0f0;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  height: 100vh;
  overflow: hidden;
}
header.navbar {
  background-color: rgba(26, 26, 26, 0.8);
  backdrop-filter: blur(10px);
  padding: 0.75rem 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #333;
  flex-shrink: 0;
}
.logo {
  font-size: 1.5rem;
  font-weight: 700;
  color: #fff;
  font-family: "Playfair Display", serif;
}
.main-content {
  display: flex;
  flex-grow: 1;
  overflow: hidden;
}
.video-area {
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
}
.meeting-info {
  text-align: center;
  margin-bottom: 20px;
  flex-shrink: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.meeting-info h1 {
  font-size: 1.75rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
}
.meeting-info p {
  color: #aaa;
  display: flex;
  align-items: center;
  gap: 8px;
}
.copy-btn {
  background: none;
  border: none;
  color: #3498db;
  cursor: pointer;
  font-size: 1rem;
  transition: color 0.2s ease;
}
.copy-btn:hover {
  color: #2980b9;
}
.copy-btn.copied {
  color: #27ae60;
}
#video-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 15px;
  width: 100%;
}
.video-container {
  position: relative;
  background-color: #000;
  border-radius: 12px;
  overflow: hidden;
  border: 2px solid transparent;
  transition: border-color 0.3s ease;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
  aspect-ratio: 16 / 9;
}
.video-container:hover {
  border-color: #3498db;
}
video.video-participant {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}
.name-tag {
  position: absolute;
  bottom: 8px;
  left: 8px;
  background-color: rgba(0, 0, 0, 0.6);
  color: #fff;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 0.8rem;
  font-weight: 500;
  z-index: 10;
}
.audio-status {
  margin-right: 5px;
  color: #27ae60;
}
.audio-status.muted {
  color: #e74c3c;
}

/* -------- Stylish Sidebar & Content -------- */
.sidebar {
  background: linear-gradient(135deg, #191970 0%, #262626 100%);
  box-shadow: 0 2px 18px rgba(10,20,60,0.17);
  border-left: 1px solid #324076;
  display: flex;
  flex-direction: column;
  height: 100%;
}
.sidebar-content, .chat-box {
  flex: 1 1 50%;
  min-height: 0;
  max-height: 50vh;
  overflow-y: auto;
  padding: 1.1rem 0.9rem;
}
.sidebar-header, .chat-header {
  background: rgba(25, 25, 112, 0.33);
  border-radius: 8px 8px 0 0;
  margin-bottom: 0.4rem;
  padding-bottom: 0.3rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.sidebar-header h2, .chat-header span {
  color: #49aaff;
  letter-spacing: 1.2px;
  font-weight: 800;
  font-size: 1.22rem;
}
#participants-count {
  background: #1fadf6;
  color: #fff;
  font-size: 1.05rem;
  padding: 0 10px;
  margin-left: 8px;
  border-radius: 14px;
  font-weight: 700;
}
#participants-list {
  list-style: none;
  padding: 0;
  margin: 0;
}
#participants-list li {
  background: rgba(35,45,100,0.11);
  margin-bottom: 7px;
  padding: 8px 12px;
  border-radius: 6px;
  color: #e9e9ff;
  font-weight: 600;
  font-size: 1.0rem;
  display: flex;
  align-items: center;
  gap: 10px;
  box-shadow: 0 1px 6px rgba(20,30,60,0.07);
  border: none;
  transition: background 0.21s;
}
#participants-list li:hover {
  background: #2359af;
  color: #fff;
}
.messages {
  background: rgba(19,34,64,0.12);
  border-radius: 8px;
  margin-bottom: 4px;
  padding: 1.1rem 0.8rem;
  box-shadow: 0 1px 8px rgba(0,0,0,0.08);
  overflow-y: auto;
}
.message {
  margin-bottom: 0.75rem;
  background: #222;
  padding: 0.5rem;
  border-radius: 8px;
  font-size: 1.01rem;
}
.message .sender {
  font-weight: 700;
  color: #1fadf6;
  font-size: 0.92rem;
  margin-bottom: 4px;
  letter-spacing: .03em;
}
.chat-input {
  display: flex;
  padding: 1rem 0.1rem;
  background: #191970;
  border-top: 1px solid #333;
  border-radius: 0 0 8px 8px;
}
.chat-input input {
  background: #193155;
  color: #e0ecff;
  border: 1.5px solid #223f6a;
  font-size: 1.05rem;
  flex-grow: 1;
  border-radius: 6px;
  padding: 0.6rem 0.9rem;
  margin-right: 8px;
}
.chat-input button {
  background: #2bb6f9;
  font-weight: 700;
  border-radius: 8px;
  border: none;
  color: #fff;
  padding: 0.5rem 1.2rem;
  cursor: pointer;
  transition: background 0.2s;
}
.chat-input button:hover {
  background: #1fa1dd;
}
/* -------- Controls at bottom -------- */
.controls {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 1rem;
  background: rgba(30, 30, 30, 0.85);
  border-radius: 50px;
  padding: 0.75rem 1.5rem;
  border: 1px solid #444;
  z-index: 1000;
}
.controls button {
  background: #4b4b4b;
  border: none;
  width: 55px;
  height: 55px;
  border-radius: 50%;
  color: #fff;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}
.controls button:hover {
  background: #6a6a6a;
  transform: translateY(-3px);
}
/* Disabled style for controls */
.controls button:disabled {
  background: #2a2a2a;
  cursor: not-allowed;
  opacity: 0.6;
}
/* Controls for off-state e.g mic muted */
.controls button[aria-pressed="false"] {
  background-color: #cc3333;
}
.controls button[aria-pressed="false"]:hover {
  background-color: #e54545;
}
.controls .icon {
  font-size: 1.3rem;
  margin-bottom: 4px;
}
.controls .label {
  font-size: 0.6rem;
  font-weight: 600;
  text-transform: uppercase;
}
.end-call-btn {
  background: #e53e3e;
}
.end-call-btn:hover {
  background: #c53030;
}

  </style>
    </head>
    <body>
        <header class="navbar">
            <div class="logo">Convox Elite</div>
        </header>

        <div class="main-content">
            <main class="video-area">
                <div class="meeting-info">
                    <h1>Live Meeting</h1>
                    <p>
                        Meeting ID: <strong id="meeting-id-display"></strong>
                        <button id="copy-link-btn" class="copy-btn" title="Copy Meeting Link">
                            <i class="far fa-copy"></i>
                        </button>
                    </p>
                </div>
                <div id="video-grid">
                </div>
            </main>

            <aside class="sidebar">
              <!-- Participants Section -->
              <div class="sidebar-content collapsible" id="participants-section">
                <div class="sidebar-header">
                  <h2>Participants</h2>
                  <button class="toggle-btn" id="toggle-participants-btn" title="Minimize/Maximize">
                    <i class="fas fa-chevron-up"></i>
                  </button>
                </div>
                <ul id="participants-list"></ul>
              </div>
          
              <!-- Messages/Chat Section -->
              <div class="chat-box collapsible" id="messages-section">
                <div class="chat-header">
                  <span>Messages</span>
                  <button class="toggle-btn" id="toggle-messages-btn" title="Minimize/Maximize">
                    <i class="fas fa-chevron-up"></i>
                  </button>
                </div>
                <div class="messages" id="chat-messages"></div>
                <div class="chat-input">
                  <input type="text" id="chat-input" placeholder="Send a message...">
                  <button id="send-chat-btn"><i class="fas fa-paper-plane"></i></button>
                </div>
              </div>
            </aside>

        </div>

        <div class="controls" role="toolbar" aria-label="Meeting controls">
            <button id="toggle-audio-btn" title="Toggle Audio" aria-pressed="true">
                <i id="audio-icon" class="fas fa-microphone icon"></i>
                <span id="audio-label" class="label">Mute</span>
            </button>
            <button id="toggle-video-btn" title="Toggle Video" aria-pressed="true">
                <i id="video-icon" class="fas fa-video icon"></i>
                <span id="video-label" class="label">Stop</span>
            </button>
            <button id="toggle-screen-share-btn" title="Screen Share" aria-pressed="false">
                <i id="screenshare-icon" class="fas fa-desktop icon"></i>
                <span id="screenshare-label" class="label">Share</span>
            </button>
            <button id="start-recording-btn" title="Start Recording" aria-pressed="false" disabled>
                <i id="recording-icon" class="fas fa-record-vinyl icon"></i>
                <span id="recording-label" class="label">Record</span>
            </button>
            <button id="end-call-btn" title="End Call">
                <i class="fas fa-phone-slash icon"></i>
                <span class="label">End</span>
            </button>
        </div>
     
        <script>
const RENDER_BACKEND_URL = 'https://convox-themetup.onrender.com';
const socket = io(RENDER_BACKEND_URL);

const videoGrid = document.getElementById('video-grid');
const myVideo = document.createElement('video');
myVideo.muted = true;
myVideo.id = 'my-video';
const peers = {};

const urlParams = new URLSearchParams(window.location.search);
const meetingId = urlParams.get('id');
const name = localStorage.getItem('userName') || 'Guest';

document.getElementById('meeting-id-display').textContent = meetingId || 'N/A';

let localStream = null;
let screenShareStream = null;
let originalVideoTrack = null;
let isScreenSharing = false;

// Controls
const toggleAudioBtn = document.getElementById('toggle-audio-btn');
const toggleVideoBtn = document.getElementById('toggle-video-btn');
const toggleScreenShareBtn = document.getElementById('toggle-screen-share-btn');
const endCallBtn = document.getElementById('end-call-btn');
const audioIcon = document.getElementById('audio-icon');
const audioLabel = document.getElementById('audio-label');
const videoIcon = document.getElementById('video-icon');
const videoLabel = document.getElementById('video-label');
const screenshareIcon = document.getElementById('screenshare-icon');
const screenshareLabel = document.getElementById('screenshare-label');

// ---- Audio / Video / Share Control Handlers ----
function updateAudioBtn(enabled) {
  toggleAudioBtn.setAttribute('aria-pressed', enabled);
  audioIcon.className = enabled ? "fas fa-microphone icon" : "fas fa-microphone-slash icon";
  audioLabel.textContent = enabled ? "Mute" : "Unmute";
}
function updateVideoBtn(enabled) {
  toggleVideoBtn.setAttribute('aria-pressed', enabled);
  videoIcon.className = enabled ? "fas fa-video icon" : "fas fa-video-slash icon";
  videoLabel.textContent = enabled ? "Stop" : "Start";
}
function updateScreenShareBtn(onShare) {
  toggleScreenShareBtn.setAttribute('aria-pressed', onShare);
  screenshareIcon.className = onShare ? "fas fa-stop-circle icon" : "fas fa-desktop icon";
  screenshareLabel.textContent = onShare ? "Stop" : "Share";
}

toggleAudioBtn.addEventListener("click", () => {
  if (!localStream) return;
  const track = localStream.getAudioTracks()[0];
  if (!track) return;
  track.enabled = !track.enabled;
  updateAudioBtn(track.enabled);
});
toggleVideoBtn.addEventListener("click", () => {
  if (!localStream) return;
  const track = localStream.getVideoTracks()[0];
  if (!track) return;
  track.enabled = !track.enabled;
  updateVideoBtn(track.enabled);
});
toggleScreenShareBtn.addEventListener("click", async () => {
  if (isScreenSharing) {
    if (screenShareStream) screenShareStream.getTracks().forEach(track => track.stop());
    screenShareStream = null;
    isScreenSharing = false;
    if (originalVideoTrack) {
      myVideo.srcObject = localStream;
      updateScreenShareBtn(false);
    }
  } else {
    try {
      screenShareStream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: false });
      isScreenSharing = true;
      myVideo.srcObject = screenShareStream;
      updateScreenShareBtn(true);
      screenShareStream.getVideoTracks()[0].onended = () => {
        toggleScreenShareBtn.click();
      };
    } catch (err) {
      alert("Screen share permission denied or cancelled.");
    }
  }
});

// ---- START MEDIA ----
async function startMedia() {
  try {
    localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
    originalVideoTrack = localStream.getVideoTracks()[0];
    addVideoStream(myVideo, localStream, name + ' (You)');
    updateAudioBtn(true);
    updateVideoBtn(true);
    updateScreenShareBtn(false);
  } catch (err) {
    alert("Could not get access to your camera and microphone! Please ensure the site is on HTTPS and you have granted permissions.");
    toggleAudioBtn.disabled = true;
    toggleVideoBtn.disabled = true;
    toggleScreenShareBtn.disabled = true;
  }
}
startMedia();

// ---- ADD VIDEO STREAM ----
function addVideoStream(videoElement, stream, userName) {
  const videoId = videoElement.id;
  const containerId = `container-${videoId}`;
  let existingContainer = document.getElementById(containerId);

  if (!existingContainer) {
    const videoContainer = document.createElement('div');
    videoContainer.classList.add('video-container');
    videoContainer.id = containerId;
    const nameTag = document.createElement('div');
    nameTag.classList.add('name-tag');
    nameTag.textContent = userName;
    videoElement.srcObject = stream;
    videoElement.addEventListener('loadedmetadata', () => videoElement.play());
    videoElement.classList.add('video-participant');
    videoContainer.append(videoElement);
    videoContainer.append(nameTag);
    videoGrid.append(videoContainer);
  } else {
    existingContainer.querySelector('.video-participant').srcObject = stream;
    existingContainer.querySelector('.name-tag').textContent = userName;
  }
}

// ---- COPY LINK ----
const copyLinkBtn = document.getElementById('copy-link-btn');
copyLinkBtn.addEventListener('click', () => {
  const meetingLink = window.location.href;
  navigator.clipboard.writeText(meetingLink).then(() => {
    copyLinkBtn.classList.add('copied');
    copyLinkBtn.title = 'Copied!';
    setTimeout(() => {
      copyLinkBtn.classList.remove('copied');
      copyLinkBtn.title = 'Copy Meeting Link';
    }, 2000);
  }).catch(err => {
    console.error('Failed to copy text:', err);
  });
});

// ---- END CALL ----
endCallBtn.addEventListener('click', () => {
  if(localStream) localStream.getTracks().forEach(t=>t.stop());
  if(screenShareStream) screenShareStream.getTracks().forEach(t=>t.stop());
  window.location.href='index.html';
});

// ---- TOGGLING SECTIONS (optional) ----
const toggleParticipantsBtn = document.getElementById('toggle-participants-btn');
const participantsSectionElem = document.getElementById('participants-section');
if (participantsSectionElem && toggleParticipantsBtn) {
  toggleParticipantsBtn.addEventListener('click', function() {
    participantsSectionElem.classList.toggle('collapsed');
    toggleParticipantsBtn.classList.toggle('collapsed');
    const icon = toggleParticipantsBtn.querySelector('i');
    icon.classList.toggle('fa-chevron-up');
    icon.classList.toggle('fa-chevron-down');
  });
}
const toggleMessagesBtn = document.getElementById('toggle-messages-btn');
const messagesSectionElem = document.getElementById('messages-section');
if (messagesSectionElem && toggleMessagesBtn) {
  toggleMessagesBtn.addEventListener('click', function() {
    messagesSectionElem.classList.toggle('collapsed');
    toggleMessagesBtn.classList.toggle('collapsed');
    const icon = toggleMessagesBtn.querySelector('i');
    icon.classList.toggle('fa-chevron-up');
    icon.classList.toggle('fa-chevron-down');
  });
}

// ---- CHAT ----
const chatMessages = document.getElementById('chat-messages');
const chatInput = document.getElementById('chat-input');
const sendChatBtn = document.getElementById('send-chat-btn');

function displayMessage(sender, message, isMe = false) {
  const messageElement = document.createElement('div');
  messageElement.classList.add('message');
  if (isMe) messageElement.style.textAlign = 'right';
  const senderElement = document.createElement('div');
  senderElement.classList.add('sender');
  senderElement.textContent = isMe ? 'You' : sender;
  const textElement = document.createElement('div');
  textElement.textContent = message;
  messageElement.appendChild(senderElement);
  messageElement.appendChild(textElement);
  chatMessages.appendChild(messageElement);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}
sendChatBtn.addEventListener('click', () => sendMessage());
chatInput.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') sendMessage();
});
function sendMessage() {
  const message = chatInput.value.trim();
  if (message) {
    displayMessage(name, message, true);
    socket.emit('chat-message', { message, meetingId, senderName: name });
    chatInput.value = '';
  }
}

// ---- RECORD BUTTON ----
const recordingBtn = document.getElementById('start-recording-btn');
const recordingIcon = document.getElementById('recording-icon');
const recordingLabel = document.getElementById('recording-label');
let mediaRecorder = null;
let recordedChunks = [];
let isRecording = false;
let combinedStream = null;

if (window.MediaRecorder && navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
  recordingBtn.disabled = false;
  recordingBtn.title = "Start Recording";
} else {
  recordingBtn.disabled = true;
  recordingBtn.title = "Recording not supported in your browser.";
}
recordingBtn.addEventListener('click', async function() {
  if (!isRecording) {
    if (!localStream) {
      alert("Need webcam/mic access first!");
      return;
    }
    if (screenShareStream) {
      combinedStream = new MediaStream([
        ...localStream.getTracks().filter(track => track.kind === "audio"),
        ...screenShareStream.getTracks()
      ]);
    } else {
      combinedStream = localStream;
    }
    recordedChunks = [];
    try {
      mediaRecorder = new MediaRecorder(combinedStream, { mimeType: 'video/webm;codecs=vp8,opus' });
    } catch (e) {
      console.error("Recording initialization error: ", e);
      alert("Recording not supported in this format: " + e.message);
      return;
    }
    mediaRecorder.ondataavailable = function(e) {
      if (e.data.size > 0) recordedChunks.push(e.data);
    };
    mediaRecorder.onstop = function() {
      const blob = new Blob(recordedChunks, { type: 'video/webm' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'meeting-recording.webm';
      document.body.appendChild(a);
      a.click();
      setTimeout(() => URL.revokeObjectURL(url), 10000);
      a.remove();
      if (combinedStream !== localStream && combinedStream) {
        combinedStream.getTracks().forEach(track => track.stop());
      }
    };
    mediaRecorder.start();
    isRecording = true;
    recordingIcon.className = "fas fa-stop icon";
    recordingLabel.textContent = 'Stop';
    recordingBtn.title = "Stop Recording";
    recordingBtn.style.background = "#e53e3e";
  } else {
    mediaRecorder.stop();
    isRecording = false;
    recordingIcon.className = "fas fa-record-vinyl icon";
    recordingLabel.textContent = 'Record';
    recordingBtn.title = "Start Recording";
    recordingBtn.style.background = "";
  }
});
</script>

    </body>
    </html>
    
